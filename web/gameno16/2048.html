<!DOCTYPE html>
<html>
<head>
  <title>Planned Economy Growth</title>
  <meta charset="utf-8">
</head>

<body style="
  background:#111;
  color:#0f0;
  font-family:Courier, monospace;
  font-size:12px;
  text-align:center;
  margin:4px;
">

<h1 style="font-size:14px;margin:4px 0;">PLANNED ECONOMY</h1>
<div id="msg" style="margin-bottom:4px;">Merge production units.</div>

<table id="grid" border="1" cellpadding="0" cellspacing="0"
  style="margin:auto;border-collapse:collapse;">
</table>

<br>

<!-- CONTROLS -->
<div>
  <button onclick="move('up')" style="width:40px;">▲</button><br>
  <button onclick="move('left')" style="width:40px;">◀</button>
  <button onclick="move('right')" style="width:40px;">▶</button><br>
  <button onclick="move('down')" style="width:40px;">▼</button>
</div>

<br>
<button onclick="resetGame()">RESET PLAN</button><br>
<button onclick="window.location.href='../../index.html'">◀ Exit</button>

<script>
var size = 4;
var grid = [];

function resetGame() {
  grid = [];
  for (var i = 0; i < size; i++) {
    grid[i] = [];
    for (var j = 0; j < size; j++) grid[i][j] = 0;
  }
  addTile();
  addTile();
  draw();
  document.getElementById("msg").innerHTML = "Merge production units.";
}

function addTile() {
  var empty = [];
  for (var i = 0; i < size; i++)
    for (var j = 0; j < size; j++)
      if (grid[i][j] === 0) empty.push([i,j]);

  if (empty.length === 0) return;
  var p = empty[Math.floor(Math.random()*empty.length)];
  grid[p[0]][p[1]] = Math.random() < 0.9 ? 2 : 4;
}

function draw() {
  var t = document.getElementById("grid");
  t.innerHTML = "";

  for (var i = 0; i < size; i++) {
    var r = t.insertRow();
    for (var j = 0; j < size; j++) {
      var c = r.insertCell();

      c.style.width = "22px";
      c.style.height = "22px";
      c.style.textAlign = "center";
      c.style.border = "1px solid #0f0";   // ← CRITICAL
      c.style.background = "#111";         // ← NOT pure black
      c.style.color = "#0f0";
      c.style.fontSize = "11px";

      c.innerHTML = grid[i][j] ? grid[i][j] : "&nbsp;";
    }
  }
}


function slide(row) {
  var arr = [];
  for (var i = 0; i < row.length; i++)
    if (row[i] !== 0) arr.push(row[i]);

  for (var i = 0; i < arr.length - 1; i++) {
    if (arr[i] === arr[i+1]) {
      arr[i] *= 2;
      if (arr[i] === 2048)
        document.getElementById("msg").innerHTML =
          "PLAN COMPLETE ☭";
      arr[i+1] = 0;
    }
  }

  var out = [];
  for (var i = 0; i < arr.length; i++)
    if (arr[i] !== 0) out.push(arr[i]);

  while (out.length < size) out.push(0);
  return out;
}

function move(dir) {
  var old = JSON.stringify(grid);

  if (dir === "left") {
    for (var i = 0; i < size; i++)
      grid[i] = slide(grid[i]);
  }

  if (dir === "right") {
    for (var i = 0; i < size; i++)
      grid[i] = slide(grid[i].reverse()).reverse();
  }

  if (dir === "up") {
    for (var j = 0; j < size; j++) {
      var col = [];
      for (var i = 0; i < size; i++) col.push(grid[i][j]);
      col = slide(col);
      for (var i = 0; i < size; i++) grid[i][j] = col[i];
    }
  }

  if (dir === "down") {
    for (var j = 0; j < size; j++) {
      var col = [];
      for (var i = 0; i < size; i++) col.push(grid[i][j]);
      col = slide(col.reverse()).reverse();
      for (var i = 0; i < size; i++) grid[i][j] = col[i];
    }
  }

  if (JSON.stringify(grid) !== old) addTile();
  draw();
}

resetGame();
</script>

</body>
</html>
