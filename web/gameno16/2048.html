<!DOCTYPE html>
<html>
<head>
  <title>Planned Economy Growth</title>
  <meta charset="utf-8">
</head>

<body style="
  background:#111;
  color:#0f0;
  font-family:Courier, monospace;
  font-size:12px;
  margin:4px;
">

<h3>PLANNED ECONOMY GROWTH</h3>
<p id="msg">Merge production units.</p>

<pre id="board">
</pre>

<button onclick="move('up')">UP</button><br>
<button onclick="move('left')">LEFT</button>
<button onclick="move('right')">RIGHT</button><br>
<button onclick="move('down')">DOWN</button><br><br>

<button onclick="resetGame()">RESET PLAN</button><br>
<button onclick="window.location.href='../../index.html'">◀ Exit</button>

<script>
var size = 4;
var grid = [];

function resetGame() {
  grid = [];
  for (var i = 0; i < size; i++) {
    grid[i] = [];
    for (var j = 0; j < size; j++) {
      grid[i][j] = 0;
    }
  }
  addTile();
  addTile();
  draw();
  document.getElementById("msg").innerHTML = "Merge production units.";
}

function addTile() {
  var empty = [];
  for (var i = 0; i < size; i++) {
    for (var j = 0; j < size; j++) {
      if (grid[i][j] === 0) empty.push([i,j]);
    }
  }
  if (empty.length === 0) return;
  var p = empty[Math.floor(Math.random()*empty.length)];
  grid[p[0]][p[1]] = 2;
}

function draw() {
  var out = "";
  for (var i = 0; i < size; i++) {
    for (var j = 0; j < size; j++) {
      if (grid[i][j] === 0) {
        out += "[   ]";
      } else {
        var n = grid[i][j];
        if (n < 10) out += "[  " + n + "]";
        else if (n < 100) out += "[ " + n + "]";
        else out += "[" + n + "]";
      }
    }
    out += "\n";
  }
  document.getElementById("board").innerHTML = out;
}

function slide(arr) {
  var a = [];
  for (var i=0;i<arr.length;i++) if (arr[i]!==0) a.push(arr[i]);

  for (var i=0;i<a.length-1;i++) {
    if (a[i]===a[i+1]) {
      a[i]*=2;
      a[i+1]=0;
      if (a[i]===2048) {
        document.getElementById("msg").innerHTML="PLAN COMPLETE ☭";
      }
    }
  }

  var r=[];
  for (var i=0;i<a.length;i++) if (a[i]!==0) r.push(a[i]);
  while (r.length<size) r.push(0);
  return r;
}

function move(dir) {
  if (dir==="left") {
    for (var i=0;i<size;i++) grid[i]=slide(grid[i]);
  }

  if (dir==="right") {
    for (var i=0;i<size;i++)
      grid[i]=slide(grid[i].reverse()).reverse();
  }

  if (dir==="up") {
    for (var j=0;j<size;j++) {
      var c=[];
      for (var i=0;i<size;i++) c.push(grid[i][j]);
      c=slide(c);
      for (var i=0;i<size;i++) grid[i][j]=c[i];
    }
  }

  if (dir==="down") {
    for (var j=0;j<size;j++) {
      var c=[];
      for (var i=0;i<size;i++) c.push(grid[i][j]);
      c=slide(c.reverse()).reverse();
      for (var i=0;i<size;i++) grid[i][j]=c[i];
    }
  }

  addTile();
  draw();
}

resetGame();
</script>

</body>
</html>
