<!DOCTYPE html>
<html>
<head>
  <title>State Minesweeper</title>
  <link rel="icon" type="image/png" href="favicon.png">
</head>

<body style="
  background:#111;
  color:#0f0;
  font-family:Courier, monospace;
  font-size:12px;
  text-align:center;
  margin:6px;
">

<h3 style="margin:2px 0;">STATE MINESWEEPER</h3>
<p style="margin:2px 0;">AVOID STATE MINES</p>

<div id="board"></div>

<p id="msg" style="margin:4px 0;"></p>

<button onclick="resetGame()">RESET</button>

<p style="font-size:10px;margin-top:6px;">
  <button onclick="window.location.href='index.html'">â—€ Exit</button>
</p>

<script>
var size = 5;
var mines = 5;
var board = [];
var revealed = [];
var gameOver = false;

function init() {
  board = [];
  revealed = [];
  gameOver = false;
  document.getElementById("msg").textContent = "";

  for (var i = 0; i < size * size; i++) {
    board[i] = 0;
    revealed[i] = false;
  }

  // PLACE MINES
  var placed = 0;
  while (placed < mines) {
    var r = Math.floor(Math.random() * size * size);
    if (board[r] !== "*") {
      board[r] = "*";
      placed++;
    }
  }

  // CALCULATE NUMBERS
  for (var i = 0; i < size * size; i++) {
    if (board[i] === "*") continue;

    var count = 0;
    var x = i % size;
    var y = Math.floor(i / size);

    for (var dy = -1; dy <= 1; dy++) {
      for (var dx = -1; dx <= 1; dx++) {
        var nx = x + dx;
        var ny = y + dy;
        var ni = ny * size + nx;

        if (nx >= 0 && nx < size && ny >= 0 && ny < size) {
          if (board[ni] === "*") count++;
        }
      }
    }
    board[i] = count;
  }

  draw();
}

function draw() {
  var html = "";
  for (var y = 0; y < size; y++) {
    for (var x = 0; x < size; x++) {
      var i = y * size + x;

      if (revealed[i]) {
        html += "<button class='cell'>" +
          (board[i] === 0 ? "" : board[i]) +
          "</button>";
      } else {
        html += "<button class='cell' onclick='reveal(" + i + ")'></button>";
      }
    }
    html += "<br>";
  }
  document.getElementById("board").innerHTML = html;
}

function reveal(i) {
  if (gameOver || revealed[i]) return;

  revealed[i] = true;

  if (board[i] === "*") {
    document.getElementById("msg").textContent =
      "BOOM. SENT TO GULAG.";
    gameOver = true;
    revealAll();
    return;
  }

  draw();
}

function revealAll() {
  for (var i = 0; i < revealed.length; i++) {
    revealed[i] = true;
  }
  draw();
}

function resetGame() {
  init();
}

init();
</script>

<style>
.cell {
  width:18px;
  height:18px;
  min-width:18px;
  min-height:18px;

  line-height:18px;
  font-size:11px;
  font-family:Courier, monospace;
  font-weight:bold;

  margin:1px;
  padding:0;

  border:1px solid #0f0;
  background:#111;
  color:#0f0;

  text-align:center;
  vertical-align:top;

  box-sizing:border-box;
  overflow:hidden;
}

/* KILL PRESS EFFECT */
.cell:active {
  padding:0;
  margin:1px;
}
</style>


</body>
</html>
